#!name=YouTube (Music)
#!desc=去除广告，优化界面，支持字幕翻译功能，支持后台播放。支持Premium订阅用户使用，不支持tvOS设备。（若使用VirgilClyne双语字幕翻译插件，则需要禁用本插件的字幕翻译功能，且需将双语字幕翻译插件调整至本插件下方）
#!author=@RuCu6 @Maasea @VirgilClyne @Choler @DivineEngine @app2smile @可莉🅥
#!icon=https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/YouTube.png
#!category=去广告, 功能增强, VirgilClyne, Maasea, Choler, DivineEngine, app2smile, 可莉
#!openUrl=https://apps.apple.com/app/id544007664
#!homepage=https://github.com/sooyaaabo/Egern
#!date=2024-07-16 23:00

[Rule]
AND, ((DOMAIN-SUFFIX, googlevideo.com),  (PROTOCOL, QUIC)), REJECT
AND, ((DOMAIN-SUFFIX, youtubei.googleapis.com),  (PROTOCOL, QUIC)), REJECT

[URL Rewrite]
# 播放页广告
^https:\/\/rr[\w-]+\.googlevideo\.com\/initplayback\? - reject-dict
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad - reject-dict
^https?:\/\/([\w-]+)\.googlevideo\.com\/initplayback(\?.*oad=.+)$ - reject-img

[Script]
# YouTube去广告 - 来自Maasea的作品
YouTube请求 = type=http-request, pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|get_watch|next|player|reel\/reel_watch_sequence), script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.request.preview.js, requires-body=true, binary-body-mode=true

YouTube响应 = type=http-response, pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(account\/get_setting|browse|get_watch|guide|next|player|reel\/reel_watch_sequence|search), script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.response.preview.js, requires-body=true, binary-body-mode=true

[MITM]
hostname = %APPEND% www.youtube.com, m.youtube.com, tv.youtube.com, music.youtube.com, youtubei.googleapis.com, -redirector*.googlevideo.com, *.googlevideo.com, rr*.googlevideo.com